# 音樂劇回購率分析

## 一、資料清整

![img](https://smalleye.notion.site/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Faad5c501-2cdf-4dbe-9e99-f8b5951d4710%2FUntitled.png?id=63283878-7ab2-4151-8599-a89a632778b0&table=block&spaceId=59f256b6-d360-48d1-a0bd-59ce111bafb5&width=2000&userId=&cache=v2)

### 新增欄位

* 是否購買第五場(目標變數)

* 總購買票數_高(>10)、總購買票數_中(5~10張)、總購買票數_低(≤4)，因為總共四場，所以超過4張代表一定有幫別人買。

* 購買場次:該顧客在四場中有購買的場次數。

* 總消費金額

* story_count: 該顧客有購買過的故事數量。

* 看過怪人: 是否看過鐘樓怪人。

* 看過羅密歐: 是否看過羅密歐與茱麗葉。

* 7天內購買次數: 在開始售票7天內購買的次數。

* 是否曾經7天內購買: 有曾經在開始售票7天內購買。

## 二、基本分析

* 以購買紀錄大於等於兩筆以上的資料客戶為主要分析對象，其中又分為網路售票網訂購和APP訂購。

* 可以發現每個人在購買票的時候，會一次買好幾張，客戶的消費心理若是只有兩筆的交易紀錄則有可能是情人伴侶，兩筆以上可能是對單一音樂劇感興趣的三五好友

## 三、客群分析

### 依照不同群體，探討其與回購率之關係:

![img](https://github.com/jason-28/Learning-Note/blob/main/img/%E5%9B%9E%E8%B3%BC1)

![img](https://github.com/jason-28/Learning-Note/blob/main/img/%E5%9B%9E%E8%B3%BC2)

* 用場次區分（兩場都看一樣的/先看其中一部的）


* 在同一場次買多張票的ID（同天不同場次都有買票的）合併

* 創造利潤的方式為老客戶的回購率和新客戶的訂購率，而從Raw_data可得知老客戶的交易紀錄比例只有4%，探討如何增加老客戶的回購率。

## 四、定義回購標準&特徵抽取

* 從前四場的顧客交易資訊中，抽取顧客特徵。並將前四場有出現過的消費者，在第五場是否有購買作為我們的目標變數。

![img](https://github.com/jason-28/Learning-Note/blob/main/img/%E5%9B%9E%E8%B3%BC3.png)

![img](https://github.com/jason-28/Learning-Note/blob/main/img/%E5%9B%9E%E8%B3%BC6.png)

### 購買場次(0.103392) VS. story_count(0.077383) : 

* 兩者相關性為 0.892586 基本上這兩個變數很相似，購買場次為總共看了幾場，story_count為看了幾個故事，從中抽取與目標變數較相關的變數，最後選擇使用購買場次。

### 總購買票數(0.030845) VS. 總購買票數_高(0.048717)、總購買票數_中(0.056483)、總購買票數_低(-0.067760) : 

* 高、中、低與總購買票數的相關性分別為 0.130627、0.469613、-0.490255。

* 可以發現從總購買票數抽取出的三個類別變數對目標函數的相關性更高了，相較於原始的變數對目標變數的掌握度也更高了，所以將總購買票數拿掉。

### 7天內購買(-0.011297)` VS. 曾經7天內購買(-0.011235): 

* 兩者相關性為 0.994833，由於兩者相關性差不多，最後選用曾經7天內購買。

### 看過怪人(-0.078668) VS. 看過羅密歐(0.127940) : 

* 兩者相關性為 -0.776712，高度負相關，所以取用看過羅密歐。

### 總購買票數_中(0.056483) VS. 總購買票數_低(-0.067760): 

* 兩者相關性為 -0.963868 ，所以取總購買票數_低。

**=>去除 story_count、總購買票數、曾經7天內購買、看過怪人、總購買票數_中**

## 五、分析結果

### 使用羅吉斯回歸預測

### 輸入特徵

features: ['購買場次', '看過羅密歐', '總消費金額', '是否曾經7天內購買', '總購買票數_高', '總購買票數_低']

target: ['是否購買第五場']

### 調整不平衡資料

* 使用under sample，將為否(0)的資料取2500個(與1的數量相近)作為訓練模型的資料，可以使模型更好辨識出是(1)的資料(真正會回購的顧客)。

### 回歸結果

* 混淆矩陣

![img](https://github.com/jason-28/Learning-Note/blob/main/img/%E5%9B%9E%E8%B3%BC4.png)

![img](https://github.com/jason-28/Learning-Note/blob/main/img/%E5%9B%9E%E8%B3%BC5.png)

* 羅吉斯回歸

係數: [[ 0.37636516 0.35832896 -0.13534102 -0.09936929 0.0777564 0.00144291]]

截距: [-0.00052455]

正確率:

[Training Accuray] 0.532、[Testing Accuray] 0.529

## 六、結論

* 最開始的模型是以極度不平衡的資料集去做訓練，導致測試時發現模型對 1(是) 的掌握度太低，雖然結果正確率很高，但與我們原先訂的目標有落差(recall為0)。

* 於是使用 undersampling 方法調整訓練資料集，並用調整過的資料去做預測，再用原先不平衡的資料集做測試。

* 雖然整體準確度下降，但發現模型對 1(是) 的掌握度提高許多(達0.75)，也表示說調整過的模型可以從未知的客戶中找到 75% 真的會回購的顧客

## 七、參考資料

https://www.maxlist.xyz/2018/07/15/cohort_analysis/

https://buzzorange.com/techorange/2020/03/26/data-war-strategy/

https://www.twblogs.net/a/5bc1578f2b717711c9247937
